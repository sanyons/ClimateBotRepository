@model ClimateBot.Web.Controllers.ChatRequest

<h2>Chatbot del Clima</h2>

<div id="chatWindow" style="width: 100%; height: 300px; border: 1px solid #ccc; padding: 10px; overflow-y: scroll;">
    <!-- Aquí se mostrarán los mensajes del chat -->
</div>

<form id="chatForm" style="margin-top: 20px;">
    <div class="form-group">
        <input type="text" id="questionInput" class="form-control" placeholder="Pregunta sobre el clima..." autocomplete="off" />
    </div>
    <button type="submit" class="btn btn-primary">Enviar</button>
</form>

@section Scripts {
    <script>
        document.getElementById('chatForm').addEventListener('submit', async function (event) {
            event.preventDefault();
            const questionInput = document.getElementById('questionInput');
            const question = questionInput.value;
            questionInput.value = ""; // Limpia el campo de entrada después de enviar

            // Mostrar la pregunta del usuario en la ventana de chat
            let chatWindow = document.getElementById('chatWindow');
            let userMessage = document.createElement('div');
            userMessage.textContent = "Tú: " + question;
            userMessage.style.marginBottom = "8px";
            chatWindow.appendChild(userMessage);

            // Enviar la pregunta al servidor y manejar la respuesta
            const response = await fetch('/Chatbot/Ask', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ question })
            });

            const data = await response.json();

            // Mostrar la respuesta del bot en la ventana de chat
            let botMessage = document.createElement('div');
            botMessage.textContent = "Bot: " + data.response;
            botMessage.style.marginBottom = "8px";
            chatWindow.appendChild(botMessage);

            // Desplazar automáticamente al final del div de chat
            chatWindow.scrollTop = chatWindow.scrollHeight;
        });
    </script>
}
